&lt;!DOCTYPE html&gt;
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Simple Leaflet Map with Drawing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  &lt;!-- Leaflet CSS --&gt;
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />

  &lt;!-- Leaflet Draw CSS --&gt;
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-draw@1.0.4/dist/leaflet.draw.css"/>

  <style>
    /* Layout styling */
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    /* Controls container styling */
    #controls {
      padding: 15px;
      background: #f8f8f8;
      border-bottom: 1px solid #ccc;
    }
    #controls label {
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
    }
    #instructions {
      width: 100%;
      max-width: 600px;
      resize: vertical;
      margin-top: 5px;
      font-family: Arial, sans-serif;
      font-size: 14px;
      padding: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
    #submitRequest {
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
    }
    #submitRequest:hover {
      background-color: #0056b3;
    }

    /* Map fills remaining vertical space */
    #map {
      flex-grow: 1;
      width: 100vw;
    }

    /* Scan type buttons styling */
    #scanTypeButtons {
      margin-bottom: 15px;
    }
    .scanTypeBtn {
      padding: 8px 14px;
      font-size: 14px;
      cursor: pointer;
      border: 1px solid #007bff;
      background-color: white;
      color: #007bff;
      border-radius: 4px;
      transition: background-color 0.3s ease;
      margin-right: 8px;
      margin-bottom: 8px;
      user-select: none;
    }

    .scanTypeBtn:hover {
      background-color: #e6f0ff;
    }

    .scanTypeBtn.selected {
      background-color: #007bff;
      color: white;
    }
  </style>
</head>
<body>

  &lt;!-- User input controls --&gt;
  <div id="controls">
    <label>Choose Drone Scan Type:</label>
    <div id="scanTypeButtons">
      <button type="button" class="scanTypeBtn" data-scan="2dMap">2D Map</button>
      <button type="button" class="scanTypeBtn" data-scan="3dVirtualMap">3D Virtual Map</button>
      <button type="button" class="scanTypeBtn" data-scan="liDARAreaScan">LiDAR Area Scan</button>
      <button type="button" class="scanTypeBtn" data-scan="realEstatePhotosVideos">Real Estate Aerial Photos/Videos</button>
      <button type="button" class="scanTypeBtn" data-scan="pavementConditionIndex">Pavement Condition Index</button>
      <button type="button" class="scanTypeBtn" data-scan="socialMediaCommercialSite">Social Media Commercial Site</button>
    </div>

    <label for="instructions">Additional Instructions:</label>
    <textarea id="instructions" name="instructions" rows="5" placeholder="Enter any special instructions here..."></textarea>

    <button id="submitRequest">Submit Scan Request</button>
  </div>

  &lt;!-- Leaflet map container --&gt;
  <div id="map"></div>

  &lt;!-- Leaflet JS --&gt;
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

  &lt;!-- Leaflet Draw JS --&gt;
  <script src="https://cdn.jsdelivr.net/npm/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>

  <script>
    // Initialize map and set view
    const map = L.map('map').setView([40.73061, -73.935242], 13);

    // Add OpenStreetMap tile layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // FeatureGroup to store drawn layers
    const drawnItems = new L.FeatureGroup();
    map.addLayer(drawnItems);

    // Initialize the draw control and pass the FeatureGroup of editable layers
    const drawControl = new L.Control.Draw({
      edit: {
        featureGroup: drawnItems,
        remove: true
      },
      draw: {
        polygon: true,
        polyline: false,
        rectangle: false,
        circle: false,
        marker: false,
        circlemarker: false
      }
    });
    map.addControl(drawControl);

    // Variable to store GeoJSON of the last drawn polygon
    let drawnAreaGeoJSON = null;

    // Event listener for when a new shape is created
    map.on(L.Draw.Event.CREATED, function (event) {
  const layer = event.layer;

  drawnItems.clearLayers();
  drawnItems.addLayer(layer);
  drawnAreaGeoJSON = layer.toGeoJSON();

  // ðŸ‘‰ Send the drawn GeoJSON back to the parent Wix iframe
  window.parent.postMessage({
    type: "geoJson",
    geoJson: drawnAreaGeoJSON
  }, "*");

  console.log('âœ… Sent GeoJSON to Wix:', drawnAreaGeoJSON);
  alert('Polygon drawn! Coordinates sent to Wix.');
});

    // Event listener for edits (if editing is used)
    map.on(L.Draw.Event.EDITED, function (event) {
      event.layers.eachLayer(function (layer) {
        drawnAreaGeoJSON = layer.toGeoJSON();
        console.log('Edited polygon GeoJSON:', drawnAreaGeoJSON);
      });
    });

    // Handle scan type button selection
    let selectedScanType = null;
    const scanButtons = document.querySelectorAll('.scanTypeBtn');

    scanButtons.forEach(button => {
      button.addEventListener('click', () => {
        // Remove 'selected' class from all buttons
        scanButtons.forEach(btn => btn.classList.remove('selected'));
        // Add 'selected' class to clicked button
        button.classList.add('selected');
        // Store selected scan type from data attribute
        selectedScanType = button.getAttribute('data-scan');
        console.log('Selected scan type:', selectedScanType);
      });
    });

    // Submit button handler
    document.getElementById('submitRequest').addEventListener('click', function () {
      const instructions = document.getElementById('instructions').value;

      if (!selectedScanType) {
        alert('Please select a drone scan type by clicking one of the buttons.');
        return;
      }

      if (!drawnAreaGeoJSON) {
        alert('Please draw an area to scan on the map before submitting.');
        return;
      }

      const scanRequest = {
        scanType: selectedScanType,
        instructions: instructions,
        areaGeoJSON: drawnAreaGeoJSON
      };

      console.log('Scan Request Data:', scanRequest);
      alert('Your scan request has been submitted! Check the console for details.');

      // TODO: Replace alert and console.log with sending data to backend or API
    });
  </script>
</body>
</html>
